<h1>My Transactions</h1>
<table style="width=100%" border="2">
<tr>
  <td>book title</td>
  <td>requester email</td>
  <td>requested email</td>
  <td>requester status</td>
  <td>requested status</td>
  <td></td>
</tr>
<% @my_transactions.each do |t| %>
  <tr>
    <td><%= Book.find(t.requested_book_id).title %></td>
    <td><%= User.find(t.user_id).email %></td>
    <td><%= Book.find(t.requested_book_id).user.email %></td>
    <td><%= t.status_requester %></td>
    <td><%= t.status_requested %></td>
    <td><%= link_to 'Cancel', t, method: :delete, data: { confirm: 'Are you sure?' } unless t.status_requested %></td>
  </tr>
<% end %>

</table>




<h1>Transactions to me</h1>
<table style="width=100%" border="2">
<tr>
  <td>book title</td>
  <td>requester email</td>
  <td>requested email</td>
  <td>requester status</td>
  <td>requested status</td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<% @transactions_to_me.each do |t| %>
  <tr>
    <td><%= Book.find(t.requested_book_id).title %></td>
    <td><%= User.find(t.user_id).email %></td>
    <td><%= Book.find(t.requested_book_id).user.email %></td>
    <td><%= t.status_requester %></td>
    <td><%= t.status_requested %></td>

    <td>
      <% @r_books = Book.where(user_id: t.user_id) %>
          <% @r_books_titles = [] %>
          <% @r_books.each  { |book| @r_books_titles<<[book.title, book.id]} %>
          
          <% if t.status_requested.nil? %>
            <%= form_for(t, {:class => "form-inline"}) do |f| %>
              <%= select_tag(:requester_book_id, options_for_select(@r_books_titles)) %>
              <div class="actions">
                <%= f.submit "Accept" %>
              </div>
            <% end %>
          <% end %>
      </td>

    <td><%= link_to "Reject", edit_transaction_path(t) %>
  </tr>
<% end %>

</table>